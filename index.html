<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>t1chm1's 自留地</title><meta name="keywords" content="t1chm1"><meta name="author" content="t1chm1"><meta name="copyright" content="t1chm1"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="道阻且长，行则将至">
<meta property="og:type" content="website">
<meta property="og:title" content="t1chm1&#39;s 自留地">
<meta property="og:url" content="http://whmsec.github.io/index.html">
<meta property="og:site_name" content="t1chm1&#39;s 自留地">
<meta property="og:description" content="道阻且长，行则将至">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://whmsec.github.io/img/avator.png">
<meta property="article:author" content="t1chm1">
<meta property="article:tag" content="t1chm1">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://whmsec.github.io/img/avator.png"><link rel="shortcut icon" href="/img/avator.png"><link rel="canonical" href="http://whmsec.github.io/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: [object Object]
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 't1chm1\'s 自留地',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-11-02 10:23:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avator.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('/img/111.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">t1chm1's 自留地</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">t1chm1's 自留地</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/11/02/sc/" title="利用windows服务之SC进行横向"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用windows服务之SC进行横向"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/02/sc/" title="利用windows服务之SC进行横向">利用windows服务之SC进行横向</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-11-02T02:07:54.000Z" title="发表于 2022-11-02 10:07:54">2022-11-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/">横向移动</a></span></div><div class="content">0x01 前言

利用windows服务进行横向渗透主要是通过sc命令，但是注意这里跟之前windows远程命令相比多了一个条件，即当前主机需要为administrator权限。

0x02 sc命令

sc命令是XP系统中功能强大的DOS命令,SC命令能与“服务控制器”和已安装设备进行通讯。SC是用于与服务控制管理器和服务进行通信的命令行程序。

利用sc命令进行横向渗透的大体流程如下：
1.与靶机建立ipc连接
1net use \\10.1.10.7\ipc$ &quot;1qaz@WSX&quot; /user:fzm\user1

2.拷贝exe到主机系统上

3.在靶机上创建一个shell的服务
1sc \\win7 create shell binpath= &quot;c:\abc.exe&quot;

4.启动shell服务
1sc \\win7 start shell

成功上线

5.删除创建的shell服务
1sc \\win7 delete shell

</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/11/01/ipc/" title="利用IPC进行横向"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用IPC进行横向"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/11/01/ipc/" title="利用IPC进行横向">利用IPC进行横向</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-11-01T03:35:35.000Z" title="发表于 2022-11-01 11:35:35">2022-11-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/">横向移动</a></span></div><div class="content">0x00 前言

IPC$(Internet Process Connection) 是为了让进程之间通信的一种“管道”，通过提供用户名密码建立了一条安全的、加密的、用于数据交换的通道。当然，还是在同一个时间，还是同样的两个IP，他们之间只能建立一个IPC$连接，脚踏多条船无论什么时候都是不可取的。通过这个连接，可以实现在被连接的目标机器上搞文件上传、下载、命令执行……


IPC$默认大概率会禁用空密码的用户进行连接，并且目前的windows系统在安装的时候都会默认禁用Administrator用户，而是创建一个普通用户并把它加到管理组内

0x01 前提条件


139或445端口开启
目标机器没有禁用IPC$连接，没有什么防火防盗拦截IPC$，139 445 端口也开了（能走445走445，不能则走139）



SMB协议（445端口）：windows文件打印共享服务
NETBios（139端口）：NetBIOS协议是一种在局域网上的程序可以使用的应用程序编程接口（API）


知道管理员的密码（明文）

0x02 常用命令
建立空连接
1net use \\10.1.10.7 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/28/bypass/" title="绕过WAF运行命令执行漏洞的方法"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="绕过WAF运行命令执行漏洞的方法"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/28/bypass/" title="绕过WAF运行命令执行漏洞的方法">绕过WAF运行命令执行漏洞的方法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-28T09:15:41.000Z" title="发表于 2022-10-28 17:15:41">2022-10-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E7%BB%95waf/">绕waf</a></span></div><div class="content">绕过WAF运行命令执行漏洞的方法
0x01 Windows（不区分大小写）
1.1 符号和命令的关系
如果命令执行的时候遇到拦截命令关键词的时候可以利用如下方法绕过：
&quot;和^是CMD命令中最常见的转义字符，还有成对的括号并不会影响命令的执行。
这里有几个需要注意的地方：
12345在命令中可以有无数个&quot;，但是不能有两个连续的^在命令中如果&quot;在^之前，则&quot;的个数必须为偶数个在命令中如果&quot;在^之后，并且带有参数，则命令中的&quot;个数必须为偶数在命令的参数中，单个字符前后&quot;的个数只能有一个或者两个如果成对的括号中间有&quot;则&quot;的个数也必须为偶数
1234567891011121314151617181920whoami    //正确执行WhOAmi    //正确执行Who&quot;amI    //正确执行((Who&quot;amI))    //错误((Who&quot;&quot;amI))    //正确执行Who&quot;&quot;&quot;&quot;&quot;&quot;&quot; ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/27/za/" title="运维"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="运维"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/27/za/" title="运维">运维</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-27T11:34:31.000Z" title="发表于 2022-10-27 19:34:31">2022-10-27</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%BF%90%E7%BB%B4%E6%9C%8D%E5%8A%A1/">运维服务</a></span></div><div class="content">0x01 mov转mp4
1fmpeg -i 1.mov -vcodec libx264 -preset fast -crf 20 -y -ab 128k 1.mp4
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/27/Permission_dimension/" title="权限维持"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="权限维持"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/27/Permission_dimension/" title="权限维持">权限维持</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-27T08:55:43.000Z" title="发表于 2022-10-27 16:55:43">2022-10-27</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/">权限维持</a></span></div><div class="content">前言
未知攻，焉知防，作为一名合格的网络保安，肯定要学习攻防的知识。
一般在获取服务器权限之后，需要用一些后门来维持权限。如果你不想被管理员发现，请隐藏好它。
windows权限维持
0x01 隐藏文件
利用文件属性
利用ADS隐藏文件内容
驱动级文件隐藏
0x02 隐藏账号
0x03 端口复用
0x04 进程注入
0x05 注册表自启动
0x06 组策略设置脚本启动
0x07 计划任务
0x08 服务自启动
0x09 WMI后门
0x10 dll 劫持
0x11 com劫持
0x12 映像劫持
linux权限维持
0x01 隐藏文件
0x02 隐藏文件时间戳
0x03 隐藏权限
0x04 隐藏历史操作命令
0x05 隐藏远程SSH登陆记录
0x06 端口复用
0x07 进程隐藏
0x08 一句话添加用户和密码
0x09 SUID Shell
0x10 ssh公私钥免密登录
0x11 软连接
0x12 SSH wrapper
0x13 strace后门
0x14 crontab 反弹shell
0x15 openssh 后门
0x16 PAM后门
0x17 rookit后门
</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/26/pydictor/" title="pydictor 工具的妙用"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="pydictor 工具的妙用"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/26/pydictor/" title="pydictor 工具的妙用">pydictor 工具的妙用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-26T07:59:39.000Z" title="发表于 2022-10-26 15:59:39">2022-10-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7/">工具</a></span></div><div class="content">0x01 前言
感觉这个工具还可以，在这里学习一下用法
0x01 场景
去除重复项
面对合并后的超大字典，还是不舍得只要频率高的词，路径字典有时候还是多多益善。去重下，照单全收
1python3 pydictor.py -tool uniqifer uniq.txt --output 1.txt
或者直接合并加去重
1python3 pydictor.py -tool uniqbiner /path --output uniq.txt
字典合并
字典都不是凭空捏造或生成的，一般都会参考前辈们公布的字典。所以，先收集百八十个字典，放到一个目录下，把字典合并起来吧。


合并目录/网站路径爆破字典


合并子域名字典


合并用户名字典


合并弱密码字典


其它各式各样的字典


1python3 pydictor.py -tool combiner /my/dict/dirpath -o comb.txt
词频统计
但是有时候我们通常不需要那么大的字典，选合并后字典的出现频率最高的前1000条保存吧。筛选出最常用的网站路径/子域名/用户名/弱密码/…
修改 lib/data/data ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/26/ffuf/" title="ffuf用法"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ffuf用法"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/26/ffuf/" title="ffuf用法">ffuf用法</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-26T06:51:15.000Z" title="发表于 2022-10-26 14:51:15">2022-10-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7/">工具</a></span></div><div class="content">用法


-u 	 指定url


-w     设置字典


-c      将响应状态码用颜色区分，windows下无法实现该效果。


-t        线程率，默认40


-p       请求延时： 0.1、0.2s


-ac      自动校准fuzz结果


-H        Header头，格式为 “Name: Value”


-X         HTTP method to use


-d         POST data


-r         跟随重定向


-recursion num     递归扫描


-x       设置代理 http 或 socks5://127.0.0.1:8080


-s     不打印附加信息，简洁输出


-e      设置脚本语言 -e .asp,.php,.html,.txt等


-o     输出文本


-of  输出格式文件，支持html、json、md、csv、或者all
匹配输出


-mc ：指定状态代码。


-ml：指定响应行数


-mr: 指定正则表达式模式


-ms：指定响应 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/26/Bounty1/" title="通过X-Forwarded-Host密码重置令牌泄露"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="通过X-Forwarded-Host密码重置令牌泄露"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/26/Bounty1/" title="通过X-Forwarded-Host密码重置令牌泄露">通过X-Forwarded-Host密码重置令牌泄露</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-26T01:53:00.000Z" title="发表于 2022-10-26 09:53:00">2022-10-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/bugbouny-tips/">bugbouny tips</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/">密码重置</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/web%E5%AE%89%E5%85%A8/">web安全</a></span></div><div class="content">0x01 前言
看到国外老哥挖洞思路挺骚的，这里记录一下。原文连接
0x02 详情
在某个网站上，发现密码重置功能

通过抓包分析

每当输入电子邮件并单击重置密码时，我们都会收到一封带有密码重置令牌链接更改密码的电子邮件
拦截密码重置请求，小哥也启动了ngrok服务器
原始请求中用ngrok服务器域添加了另一个标头“X-Forwarded-Host”

这次收到了一封更改密码的电子邮件，并且使用ngrok服务器域名。密码重置令牌链接如下所示：

https://95saf4ct71g.ngrok.io/action-token?key=wia2lkIiA6ICciOiJIUzI1NiIsInR5cCIgODU2ZeyJhbGiA

可以看到，只需在密码重置请求中添加标题“X-Forwarded-Host”，即可成功更改host
然后小哥注意到，如果在密码重置页面中输入受害者的电子邮件，并拦截该请求，如果我请求包中添加“X-Forwarded-Host”为恶意的域名。然后，受害者将收到一封带有我的恶意域的密码重置令牌链接的电子邮件。当受害者点击该链接时，他将重定向到我的网站，他的所有令 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/10/25/Domain_User_Privilege_Escalation/" title="Kerberos 域用户提权漏洞"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kerberos 域用户提权漏洞"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/25/Domain_User_Privilege_Escalation/" title="Kerberos 域用户提权漏洞">Kerberos 域用户提权漏洞</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-24T22:30:16.000Z" title="发表于 2022-10-25 06:30:16">2022-10-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/MS14-068/">MS14-068</a></span></div><div class="content">0x00 前言
在 2014 年微软修复了 Kerberos 域用户提权漏洞，即 MS14-068，CVE 编号为 CVE-2014-6324，该漏洞影响了 Windows Server 2012 R2 以下的服务器，该漏洞允许 攻击者 将任意用户权限提升至域管级别。
14-068 产生的原因主要在于用户在向KDC申请TGT时，可以伪造自己的Kerberos票据。如果票据声明自己有域管理员权限，而KDC在处理票据时未验证票据的签名，那么，返给用户的TGT就使普通域用户拥有了域管理员权限。该用户可以将TGT发送到KDC，KDC的TGS在验证TGT后，将ST发送给该用户，而该用户拥有访问该服务的权限，从而使攻击者可以访问域内的资源。
0x01 PyKEK
PyKEK 是一个利用 Kerberos 协议进行渗透的工具包，下载地址
使用 PyKEK 可以生成一个高权限的服务票据，并通过 mimikatz 将服务票据导入到内存中。
MS 14-068 的补丁为：KB3011780，通过 wmic 查看补丁情况，未发现其补丁
1wmic qfe get hotfixid | findstr KB3 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/10/24/dig_sql/" title="如何快速挖掘sql注入漏洞"><img class="post_bg" src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何快速挖掘sql注入漏洞"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/10/24/dig_sql/" title="如何快速挖掘sql注入漏洞">如何快速挖掘sql注入漏洞</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-10-24T08:24:13.000Z" title="发表于 2022-10-24 16:24:13">2022-10-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/bugbouny-tips/">bugbouny tips</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Sql%E6%B3%A8%E5%85%A5/">Sql注入</a></span></div><div class="content">0x00 前言
在一个平台上看到国外小哥的一篇文章，如何快速挖到sql注入漏洞
0x01 思路
第一步，使用waybackurls工具爬去网页的所有链接，可以添加筛选的条件，uro是一个删除重复网址的工具
1waybackurls https://redacted.org/ | uro | grep “.php” &gt; php-files.txt
第二步，发现PHP文件名看起来很有趣，由get开头，尝试制作参数字典，进行一系列的处理

1cat php-files.txt| grep -i get | sed ‘s/.*.get//’ | sort -u
只需要 grep 包含get字符串的行并删除它之前的所有行并使其唯一以避免重复

但我们应该删除 .php 字符串来创建一个列表，所以我只是将这一行添加到最后一个命令cut -f1 -d”.”

我注意到我所有的字符串都包含两个单词，我不知道它们中的哪个是参数，所以让我们拆分它
如何在一行中找到大写字母，并拆分成行    sed ‘s/[AZ]+/\n&amp;/g’

认为大多数参数都是小写的，而不是大写的，所以我将其保留为大写 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avator.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">t1chm1</div><div class="author-info__description">道阻且长，行则将至</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/whmsec"><i class="fab fa-github"></i><span>github</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">道阻且长，行则将至</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/02/sc/" title="利用windows服务之SC进行横向"><img src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用windows服务之SC进行横向"/></a><div class="content"><a class="title" href="/2022/11/02/sc/" title="利用windows服务之SC进行横向">利用windows服务之SC进行横向</a><time datetime="2022-11-02T02:07:54.000Z" title="发表于 2022-11-02 10:07:54">2022-11-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/01/ipc/" title="利用IPC进行横向"><img src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="利用IPC进行横向"/></a><div class="content"><a class="title" href="/2022/11/01/ipc/" title="利用IPC进行横向">利用IPC进行横向</a><time datetime="2022-11-01T03:35:35.000Z" title="发表于 2022-11-01 11:35:35">2022-11-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/28/bypass/" title="绕过WAF运行命令执行漏洞的方法"><img src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="绕过WAF运行命令执行漏洞的方法"/></a><div class="content"><a class="title" href="/2022/10/28/bypass/" title="绕过WAF运行命令执行漏洞的方法">绕过WAF运行命令执行漏洞的方法</a><time datetime="2022-10-28T09:15:41.000Z" title="发表于 2022-10-28 17:15:41">2022-10-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/27/za/" title="运维"><img src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="运维"/></a><div class="content"><a class="title" href="/2022/10/27/za/" title="运维">运维</a><time datetime="2022-10-27T11:34:31.000Z" title="发表于 2022-10-27 19:34:31">2022-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/10/27/Permission_dimension/" title="权限维持"><img src="/img/111.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="权限维持"/></a><div class="content"><a class="title" href="/2022/10/27/Permission_dimension/" title="权限维持">权限维持</a><time datetime="2022-10-27T08:55:43.000Z" title="发表于 2022-10-27 16:55:43">2022-10-27</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/bugbouny-tips/"><span class="card-category-list-name">bugbouny tips</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"><span class="card-category-list-name">内网渗透</span><span class="card-category-list-count">10</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"><span class="card-category-list-name">渗透测试</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E8%BF%90%E7%BB%B4%E6%9C%8D%E5%8A%A1/"><span class="card-category-list-name">运维服务</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/MS14-068/" style="font-size: 1.1em; color: #999">MS14-068</a> <a href="/tags/Powershell/" style="font-size: 1.1em; color: #999">Powershell</a> <a href="/tags/Sql%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">Sql注入</a> <a href="/tags/kerberos/" style="font-size: 1.1em; color: #999">kerberos</a> <a href="/tags/web%E5%AE%89%E5%85%A8/" style="font-size: 1.1em; color: #999">web安全</a> <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" style="font-size: 1.5em; color: #99a9bf">信息收集</a> <a href="/tags/%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/" style="font-size: 1.1em; color: #999">密码重置</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.3em; color: #99a1ac">工具</a> <a href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" style="font-size: 1.1em; color: #999">文件上传</a> <a href="/tags/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" style="font-size: 1.1em; color: #999">权限维持</a> <a href="/tags/%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/" style="font-size: 1.3em; color: #99a1ac">横向移动</a> <a href="/tags/%E7%BB%95waf/" style="font-size: 1.1em; color: #999">绕waf</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">十月 2022</span><span class="card-archive-list-count">15</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">17</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">21k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-11-02T02:23:09.275Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2022 By t1chm1</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["道阻且长，行则将至"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '道阻且长，行则将至'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>